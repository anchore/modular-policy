{
  "comment": "Anchore DoD Dockerfile checks.",
  "id": "DoDDockerfileChecks",
  "name": "Dockerfile Checks",
  "rules": [
    {
      "action": "STOP",
      "gate": "dockerfile",
      "id": "c270be70-80a5-4342-b15d-c9174a780c9c",
      "params": [
        {
          "name": "ports",
          "value": "22,23,80,443"
        },
        {
          "name": "type",
          "value": "blacklist"
        }
      ],
      "trigger": "exposed_ports"
    },
    {
      "action": "WARN",
      "comment": "User COPY instruction instead of ADD instruction in the Dockerfile",
      "gate": "dockerfile",
      "id": "e9eacc50-aaac-4241-95ac-790cf0be84da",
      "params": [
        {
          "name": "instruction",
          "value": "ADD"
        },
        {
          "name": "check",
          "value": "exists"
        }
      ],
      "trigger": "instruction"
    },
    {
      "action": "WARN",
      "comment": "Do not use update instructions such as apt-get update alone or in a single line in the Dockerfile",
      "gate": "dockerfile",
      "id": "2f87d4bf-e963-496a-8b3d-ff90bef46014",
      "params": [
        {
          "name": "instruction",
          "value": "RUN"
        },
        {
          "name": "check",
          "value": "like"
        },
        {
          "name": "value",
          "value": "(\\s*/bin/sh\\s*-c\\s*)*\\s*apk.*up(date|grade)\\s*$"
        }
      ],
      "trigger": "instruction"
    },
    {
      "action": "WARN",
      "comment": "Do not use update instructions such as apt-get update alone or in a single line in the Dockerfile",
      "gate": "dockerfile",
      "id": "ea1b1c11-0633-48cc-8afc-92b252f331b3",
      "params": [
        {
          "name": "instruction",
          "value": "RUN"
        },
        {
          "name": "check",
          "value": "like"
        },
        {
          "name": "value",
          "value": "(\\s*/bin/sh\\s*-c\\s*)*\\s*yum.*up(date|grade)\\s*$"
        }
      ],
      "trigger": "instruction"
    },
    {
      "action": "WARN",
      "comment": "Do not use update instructions such as apt-get update alone or in a single line in the Dockerfile",
      "gate": "dockerfile",
      "id": "c5dbe7b8-b48b-4845-beff-069421d9d1ba",
      "params": [
        {
          "name": "instruction",
          "value": "RUN"
        },
        {
          "name": "check",
          "value": "like"
        },
        {
          "name": "value",
          "value": "(\\s*/bin/sh\\s*-c\\s*)*\\s*apt(-get)*.*up(date|grade)\\s*$"
        }
      ],
      "trigger": "instruction"
    },
    {
      "action": "WARN",
      "comment": "Add HEALTHCHECK instruction in your Docker container images to perform the health check on running containers",
      "gate": "dockerfile",
      "id": "64499886-5917-4a41-b18b-7d2d0bdcf12b",
      "params": [
        {
          "name": "instruction",
          "value": "HEALTHCHECK"
        },
        {
          "name": "check",
          "value": "not_exists"
        }
      ],
      "trigger": "instruction"
    }
  ],
  "version": "1_0"
}
