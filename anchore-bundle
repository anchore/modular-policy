#!/usr/bin/env python3

import click
import json
import sys

from bundle import allowlist_json_from_eval


verbose = False


@click.group()
def main():
    """
    Anchore policy bundle management utility
    """
    pass


@main.command()
@click.argument('compliance')
#help="path to compliance report JSON file")
@click.option(
        '--gates', '-g',
        type=click.File(),
        help="path to gates report CSV file",
)
@click.option(
        '--security', '-s',
        type=click.File(),
        help="path to security (CVEs) report CSV file",
)
@click.option(
        '--bundle-dir', '-b',
        type=click.Path(),
        help='path to policy bundle component directory',
)
def allow_from_eval(compliance, gates, security, bundle_dir):
    """
    Generates an allowlist from eval output files
    """
    allowlist_json_from_eval(compliance, gates, security, bundle_dir)


if __name__ == "__main__":
    main(auto_envvar_prefix='ANCHORE_BUNDLE')
